<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generador de Audio Pro Interactivo</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    background: linear-gradient(135deg, #6B73FF 0%, #000DFF 100%);
    color: #fff;
    min-height: 100vh;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
h1 { font-size: 2.2rem; margin-bottom: 10px; text-shadow: 1px 1px 5px #000; }
textarea { width: 80%; height: 150px; margin-bottom: 10px; padding: 10px; font-size: 16px; border-radius: 8px; border: none; outline: none; }
select, input[type="range"], button { padding: 10px; margin: 5px; font-size: 16px; border-radius: 8px; border: none; outline: none; }
button { cursor: pointer; background-color: #FF6B6B; color: #fff; transition: 0.3s; }
button:hover { background-color: #FF3B3B; }
label { margin-right: 10px; font-weight: bold; }
.range-container, .progress-container { display: flex; align-items: center; justify-content: center; margin-bottom: 10px; gap: 10px; }
#progressBar { width: 300px; height: 20px; background: #fff; border-radius: 10px; overflow: hidden; }
#progress { height: 100%; width: 0%; background: #FF3B3B; transition: width 0.1s; }
.button-container { display: flex; gap: 20px; margin-top: 10px; }
</style>
</head>
<body>
<h1>Generador de Audio Pro Interactivo</h1>
<p>Escribe tu texto y usa <strong>[PAUSA]</strong> donde quieras la pausa de 5 segundos.</p>
<textarea id="textInput" placeholder="Escribe tu texto aquí..."></textarea><br>

<select id="voiceSelect"></select><br>

<div class="range-container">
<label for="rateRange">Velocidad:</label>
<input type="range" id="rateRange" min="0.5" max="2" value="0.8" step="0.1">
<span id="rateValue">0.8x</span>
</div>

<div class="progress-container">
<div id="progressBar"><div id="progress"></div></div>
<span id="pauseCounter">Pausa: 0 / 0</span>
</div>

<div class="button-container">
<button onclick="playAudio()">Reproducir</button>
<button onclick="downloadAudio()">Descargar</button>
</div>

<script>
let voices = [], audioChunks = [], recorder, audioCtx;
const voiceSelect = document.getElementById("voiceSelect");
const rateRange = document.getElementById("rateRange");
const rateValue = document.getElementById("rateValue");
const progress = document.getElementById("progress");
const pauseCounter = document.getElementById("pauseCounter");

// Mostrar valor de velocidad
rateRange.addEventListener("input", () => { rateValue.textContent = rateRange.value + "x"; });

// Cargar voces en español/latino
function loadVoices() {
    voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith("es"));
    voiceSelect.innerHTML = "";
    voices.forEach((voice, i) => {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = voice.name + ` (${voice.lang})`;
        voiceSelect.appendChild(option);
    });
}
speechSynthesis.onvoiceschanged = loadVoices;

// Función de reproducción
function playAudio() {
    const text = document.getElementById("textInput").value;
    const pauseDuration = 5000;
    const selectedVoice = voices[voiceSelect.value];
    const rate = parseFloat(rateRange.value);
    const parts = text.split("[PAUSA]");

    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const dest = audioCtx.createMediaStreamDestination();
    recorder = new MediaRecorder(dest.stream);
    audioChunks = [];
    recorder.ondataavailable = e => audioChunks.push(e.data);
    recorder.start();

    let index = 0;
    pauseCounter.textContent = `Pausa: 0 / ${parts.length-1}`;

    function speakPart() {
        if (index >= parts.length) { setTimeout(() => recorder.stop(), 500); return; }
        const utterance = new SpeechSynthesisUtterance(parts[index].trim());
        utterance.voice = selectedVoice;
        utterance.rate = rate;
        utterance.onend = () => {
            progress.style.width = `${((index+1)/parts.length)*100}%`;
            pauseCounter.textContent = `Pausa: ${index} / ${parts.length-1}`;
            if(index < parts.length-1) setTimeout(() => { index++; speakPart(); }, pauseDuration);
            else index++;
        };
        speechSynthesis.speak(utterance);
    }
    speakPart();
}

// Función de descarga
function downloadAudio() {
    if(audioChunks.length === 0){ alert("Primero reproduce el audio para generar la grabación."); return; }
    const blob = new Blob(audioChunks,{ type:'audio/wav' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download='audio.wav'; a.click();
    URL.revokeObjectURL(url);
}
</script>

</body>
</html>
